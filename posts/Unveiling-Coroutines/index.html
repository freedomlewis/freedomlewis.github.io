<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Unveiling Coroutines - Stackful vs. Stackless and How Kotlin Does It" /><meta property="og:locale" content="en" /><meta name="description" content="Introduction" /><meta property="og:description" content="Introduction" /><link rel="canonical" href="https://freedomlewis.github.io/posts/Unveiling-Coroutines/" /><meta property="og:url" content="https://freedomlewis.github.io/posts/Unveiling-Coroutines/" /><meta property="og:site_name" content="Lewis’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-04-17T04:12:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Unveiling Coroutines - Stackful vs. Stackless and How Kotlin Does It" /><meta name="twitter:site" content="@do_right_thing_" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-04-17T04:12:00+00:00","datePublished":"2024-04-17T04:12:00+00:00","description":"Introduction","headline":"Unveiling Coroutines - Stackful vs. Stackless and How Kotlin Does It","mainEntityOfPage":{"@type":"WebPage","@id":"https://freedomlewis.github.io/posts/Unveiling-Coroutines/"},"url":"https://freedomlewis.github.io/posts/Unveiling-Coroutines/"}</script><title>Unveiling Coroutines - Stackful vs. Stackless and How Kotlin Does It | Lewis's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Lewis's Blog"><meta name="application-name" content="Lewis's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Lewis's Blog</a></div><div class="site-subtitle font-italic">Stay Hungry Stay Foolish</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/freedomlewis" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/do_right_thing_" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['oppolewis','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Unveiling Coroutines - Stackful vs. Stackless and How Kotlin Does It</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Unveiling Coroutines - Stackful vs. Stackless and How Kotlin Does It</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/do_right_thing_">Lewis Lee</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1713327120" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2024-04-17 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="607 words"> <em>3 min</em> read</span></div></div></div><div class="post-content"><p><strong>Introduction</strong></p><p>The world of asynchronous programming thrives on concurrency, and coroutines have emerged as powerful tools to manage concurrent tasks efficiently. But within the realm of coroutines, there lies a distinction: stackful and stackless. This blog post will delve into these concepts and explore how Kotlin leverages stackless coroutines for asynchronous mastery.</p><p><strong>Stackful Coroutines: A Familiar Friend</strong></p><p>Imagine a function call. It utilizes a portion of the program’s memory stack to store information about its execution, local variables, and the return address. Stackful coroutines operate similarly. Each coroutine possesses its own stack space, just like a regular function.</p><ul><li><p><strong>Suspension and Resumption:</strong> When a stackful coroutine needs to pause its execution (yield control), it saves its current state (local variables, program counter) on its dedicated stack. When resumed, it retrieves the state from the stack and continues execution.</p><li><p><strong>Advantages:</strong></p><ul><li><strong>Simpler Implementation:</strong> The stack-based approach mirrors function calls, making stackful coroutines easier to understand and debug.<li><strong>Control Granularity:</strong> Developers have more control over the coroutine’s stack allocation and memory usage.</ul><li><p><strong>Disadvantages:</strong></p><ul><li><strong>Stack Overflow Woes:</strong> Each coroutine’s dedicated stack space can lead to stack overflow errors if too many coroutines are created.<li><strong>Context Switching Overhead:</strong> Switching between coroutines involves saving and restoring the state on the stack, which can be inefficient for a high number of coroutines.</ul></ul><p><strong>Stackless Coroutines: A Lightweight Alternative</strong></p><p>Stackless coroutines break free from the constraints of dedicated stacks. Here’s what sets them apart:</p><ul><li><p><strong>No Stack, No Problem:</strong> Unlike their stackful counterparts, stackless coroutines don’t have their own stack space. Instead, a separate “coroutine scheduler” manages their state. This scheduler allocates memory for coroutine data and handles context switching.</p><li><p><strong>Suspension and Resumption Redefined:</strong> When a stackless coroutine yields control, the scheduler saves its state (registers, program counter) in a lightweight data structure. The scheduler then switches to another coroutine. When the first coroutine resumes, its state is restored from the data structure, and it picks up where it left off.</p><li><p><strong>Advantages:</strong></p><ul><li><strong>Lightweight Champion:</strong> The lack of dedicated stacks makes stackless coroutines lightweight, enabling a vast number of concurrent coroutines without stack overflow concerns.<li><strong>Context Switching Efficiency:</strong> Switching between coroutines involves manipulating a data structure managed by the scheduler, potentially faster than stack-based operations.</ul><li><p><strong>Disadvantages:</strong></p><ul><li><strong>Complexity Curve:</strong> Understanding and debugging stackless coroutines can be trickier due to the absence of a dedicated stack for each coroutine.<li><strong>Less Control at the Helm:</strong> Developers have less control over the coroutine’s memory usage and scheduling behavior compared to stackful coroutines.</ul></ul><p><strong>Choosing the Right Coroutine for the Job</strong></p><p>The choice between stackful and stackless coroutines depends on your project’s requirements:</p><ul><li><strong>For simpler applications with a limited number of coroutines, stackful coroutines might be suitable due to their straightforward implementation.</strong><li><strong>For applications demanding a high volume of concurrent tasks and peak performance, stackless coroutines, like those employed by Kotlin, become the clear choice due to their scalability and efficiency.</strong></ul><p><strong>Kotlin Coroutines: Embracing the Stackless Power</strong></p><p>Kotlin, a modern language known for its developer-friendly features, takes the stackless coroutines approach. Here’s why:</p><ul><li><strong>Memory Efficiency:</strong> Kotlin coroutines rely on a coroutine scheduler for state management, eliminating the need for individual stacks and promoting efficient memory usage.<li><strong>Performance Champion:</strong> The stackless design allows for faster context switching between coroutines, contributing to overall application performance.<li><strong>Simplified Asynchronous Programming:</strong> Kotlin provides a well-designed coroutine API that streamlines asynchronous programming compared to manual thread management.</ul><p>By understanding the concepts of stackful and stackless coroutines, you can make informed decisions when building asynchronous applications. Kotlin’s stackless coroutine implementation empowers developers to write clean, concurrent, and performant code. So, the next time you delve into asynchronous programming, consider the power of stackless coroutines and how Kotlin makes asynchronous development a breeze!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tech/'>Tech</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/coroutine/" class="post-tag no-text-decoration" >Coroutine</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Unveiling Coroutines - Stackful vs. Stackless and How Kotlin Does It - Lewis&#39;s Blog&amp;url=https://freedomlewis.github.io/posts/Unveiling-Coroutines/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/summary-of-2025/">Review of 2025 & Hopes for 2026</a><li><a href="/posts/stop-doing-list/">Stop Doing List</a><li><a href="/posts/warning-list/">Warning List</a><li><a href="/posts/what-is-AI/">What is AI</a><li><a href="/posts/BBK-core-values/">步步高企业文化</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/my/">My</a> <a class="post-tag" href="/tags/poem/">Poem</a> <a class="post-tag" href="/tags/coroutine/">Coroutine</a> <a class="post-tag" href="/tags/core-values/">Core Values</a> <a class="post-tag" href="/tags/data-structure/">Data Structure</a> <a class="post-tag" href="/tags/ai/">AI</a> <a class="post-tag" href="/tags/architecture/">Architecture</a> <a class="post-tag" href="/tags/habit/">Habit</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/master-kotlin-coroutine/"><div class="card-body"> <em class="timeago small" data-ts="1713251940" > 2024-04-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Mastering Kotlin Coroutines in Android Development</h3><div class="text-muted small"><p> In the ever-evolving world of Android development, building responsive and efficient apps is paramount. Traditional threading approaches often lead to complex code and potential pitfalls. Enter Kot...</p></div></div></a></div><div class="card"> <a href="/posts/Structured-Concurrency/"><div class="card-body"> <em class="timeago small" data-ts="1713330840" > 2024-04-17 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Taming the Wild West - Structured Concurrency for Reliable Asynchronous Programming</h3><div class="text-muted small"><p> The world of software development thrives on getting things done concurrently. But with great concurrency comes great responsibility – the responsibility to write clean, maintainable, and bug-free ...</p></div></div></a></div><div class="card"> <a href="/posts/LRUCache/"><div class="card-body"> <em class="timeago small" data-ts="1714449720" > 2024-04-30 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Unveiling the Android LRUCache - A Peek Under the Hood</h3><div class="text-muted small"><p> Ever wondered how Android keeps your frequently used data readily available while maintaining smooth performance? A significant player in this game is the LRUCache (Least Recently Used Cache). This...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/master-kotlin-coroutine/" class="btn btn-outline-primary" prompt="Older"><p>Mastering Kotlin Coroutines in Android Development</p></a> <a href="/posts/Structured-Concurrency/" class="btn btn-outline-primary" prompt="Newer"><p>Taming the Wild West - Structured Concurrency for Reliable Asynchronous Programming</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/do_right_thing_">Lewis Lee</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">All rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/my/">My</a> <a class="post-tag" href="/tags/poem/">Poem</a> <a class="post-tag" href="/tags/coroutine/">Coroutine</a> <a class="post-tag" href="/tags/core-values/">Core Values</a> <a class="post-tag" href="/tags/data-structure/">Data Structure</a> <a class="post-tag" href="/tags/ai/">AI</a> <a class="post-tag" href="/tags/architecture/">Architecture</a> <a class="post-tag" href="/tags/habit/">Habit</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
